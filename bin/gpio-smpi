#!/usr/bin/env python3

import sys
from gpio.gpio import GPIO
from gpio.pins import PinMode

def print_usage():
    print("Usage:")
    print("  gpio-smpi <pin> mode <in|out>")
    print("  gpio-smpi <pin> write <on|off>")
    print("  gpio-smpi <pin> read")
    print("  gpio-smpi readall")

def main():
    if len(sys.argv) < 3:
        print_usage()
        sys.exit(1)

    gpio = GPIO(PinMode.BCM)

    pin = int(sys.argv[1])
    command = sys.argv[2]

    if command == "mode":
        if len(sys.argv) != 4:
            print_usage()
            sys.exit(1)
        mode = sys.argv[3]
        gpio.set_direction(pin, direction=mode)

    elif command == "write":
        if len(sys.argv) != 4:
            print_usage()
            sys.exit(1)
        value = sys.argv[3]
        gpio.write(pin, 1 if value == "on" else 0)

    elif command == "read":
        if len(sys.argv) != 3:
            print_usage()
            sys.exit(1)
        value = gpio.read(pin)
        print(f"Pin {pin}: {value}")

    elif command == "readall":
        gpio.read_all()

    else:
        print_usage()

if __name__ == "__main__":
    main()
